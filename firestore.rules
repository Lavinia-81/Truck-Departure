/**
 * @file Firebase Security Rules for Firestore.
 *
 * @core_philosophy This ruleset secures the `dispatchSchedules` collection, restricting write access to authenticated users only, while allowing public read access.
 * @data_structure The data is stored in a top-level collection called `dispatchSchedules`, with each document representing a dispatch schedule.
 * @key_security_decisions
 *   - Read access is public.
 *   - Write access is restricted to authenticated users.
 *   - User listing is disallowed.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants public read access to dispatch schedules, but restricts write access to authenticated users only.
     * @path /dispatchSchedules/{dispatchScheduleId}
     * @allow (get, list) Any user can read dispatch schedules.
     * @allow (create) An authenticated user can create a dispatch schedule.
     * @deny (create) An unauthenticated user cannot create a dispatch schedule.
     * @deny (update) An unauthenticated user cannot update a dispatch schedule.
     * @deny (delete) An unauthenticated user cannot delete a dispatch schedule.
     * @principle Allows public read access, but enforces authentication for write access.
     */
    match /dispatchSchedules/{dispatchScheduleId} {
      allow get: if true;
      allow list: if true;

      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    // ---- Helper functions ----
    function isSignedIn() {
      return request.auth != null;
    }
  }
}